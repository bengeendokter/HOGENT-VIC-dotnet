@page "/vm/{id:int}"
@using System.Globalization
@inject IVirtualMachineService VMService

@if (vm == null)
{
    <p>Loading...</p>
    return;
}

<GenericLayout Display=false Title=@vm.Name> 
    <Content>

        <div class="main_heading">
            <h1 id="vm-title"><a class="breadcrumb" href="/vm">Virtuele Machine</a> - (@vm.Name)</h1>
            @*TODO move wijzigen to top right*@
            <a>Bewerken</a>
        </div>
        <section aria-labelledby="vm-title" class="details">
            <div class="details_group">
                <section class="details_item">
                    <h2>Algemeen</h2>
                    <table class="table">
                        <tr>
                            <th>Naam</th>
                            <td>@vm.Name</td>
                        </tr>
                        <tr>
                            <th>Hostname</th>
                            <td>@vm.HostName</td>
                        </tr>
                        <tr>
                            <th>Gebruiker</th>
                            <td>admin</td>
                        </tr>
                        <tr>
                            <th>Wachtwoord</th>
                            <td>***********</td>
                        </tr>
                        <tr>
                            <th>Startdatum gebruik</th>
                            <td>@vm.StartDate.ToString("dd-MM-yyyy", DateTimeFormatInfo.InvariantInfo)</td>
                        </tr>
                        <tr>
                            <th>Einddatum gebruik</th>
                            <td>@vm.EndDate.ToString("dd-MM-yyyy", DateTimeFormatInfo.InvariantInfo)</td>
                        </tr>
                        <tr>
                            <th>FQDN</th>
                            <td>@vm.FQDN</td>
                        </tr>
                        <tr>
                            <th>Hoge beschikbaarheid</th>
                            <td>@(
                                    vm.IsHighAvailable ? "Ja" : "Nee"
                        )</td>
                        </tr>
                        <tr>
                            <th>Template</th>
                            <td><span lang="en">@vm.Template?.Name</span></td>
                        </tr>
                        <tr>
                            <th>Backup</th>
                            <td>@(
                                    vm.EBackupFrequency == EBackupFrequency.Daily ? "Dagelijks" : "Wekelijks"
                        ) </td>
                        </tr>
                        <tr>
                            <th>Modus</th>
                            <td>@vm.Template?.Mode</td>
                        </tr>
                        <tr>
                            <th>Dagen besschikbaar</th>
                            <td>
                                <div class="weekdays">
                                @if (vm.Availability != null && days != null)
                                {
                                    @foreach (KeyValuePair<string, bool> kvp in days)
                                        {
                                            <div class=@("day " + (kvp.Value ? "available" : ""))>
                                                <span title=@kvp.Key aria-hidden="true">@kvp.Key.Substring(0,2)</span>
                                                <span class="sr_only">@($"{kvp.Key} {(kvp.Value ? "" : "niet ")}beschikbaar")</span>
                                        </div>
                                        }
                                }
                                </div>
                            </td>
                        </tr>
                    </table>
                </section>

                <secion class="details_item specifications">
                    <h2>Specificaties</h2>
                    <table class="table">
                        <tr>
                            <th>Status</th>
                            <td>
                                <span class=@(String.Join(" ", new List<string>() {"vm_status", vm.IsActive ? "active" : ""}))>
                                    @(
                                        vm.IsActive ? "Aan" : "Uit"
                        )
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <th>CPU</th>
                            <td>@vm.Template?.Stats?.Cpu cores</td>
                        </tr>
                        <tr>
                            <th>Ram</th>
                            <td>@vm.Template?.Stats?.Ram GB</td>
                        </tr>
                        <tr>
                            <th>Opslag</th>
                            <td>@vm.Template?.Stats?.Storage GB</td>
                        </tr>
                    </table>
                </secion>
            </div>
        </section>

    </Content>
</GenericLayout>

@code {
    [Parameter] public int Id { get; set; }
    private VirtualMachine? vm;

    private Dictionary<String, bool>? days;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        vm = VMService.Get(Id);

        days = new(){
        {"Maandag", vm.Availability.Value.HasFlag(EDay.Monday)}
        ,{"Dinsdag", vm.Availability.Value.HasFlag(EDay.Tuesday)}
        ,{"Woensdag", vm.Availability.Value.HasFlag(EDay.Wednesday)}
        ,{"Donderdag", vm.Availability.Value.HasFlag(EDay.Thursday)}
        ,{"Vrijdag", vm.Availability.Value.HasFlag(EDay.Friday)}
        ,{"Zaterdag", vm.Availability.Value.HasFlag(EDay.Saturday)}
        ,{"Zondag", vm.Availability.Value.HasFlag(EDay.Sunday)}
        };
    }
}